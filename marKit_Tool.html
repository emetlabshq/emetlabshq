<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Previewer</title>
    <style>
        /* General Styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #fff;
            color: #000;
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            padding: 10px;
            background: #ff0000;
            color: white;
            text-align: center;
        }

        #container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #editor, #preview {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        #editor {
            background: #f9f9f9;
            border-right: 1px solid #ddd;
        }

        #preview {
            background: #fff;
        }

        /* Themes */
        .dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        .dark-mode header {
            background: #333;
        }

        .dark-mode #editor {
            background: #1e1e1e;
            color: #e0e0e0;
        }

        .dark-mode #preview {
            background: #242424;
            color: #e0e0e0;
        }

        .light-mode {
            background-color: #f5f5f5;
            color: #333;
        }

        .light-mode header {
            background: #ff0000;
        }

        /* Controls */
        #controls {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f4f4f4;
            border-bottom: 1px solid #ddd;
        }

        #controls button, #controls select {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #controls select {
            padding: 5px;
        }

        .hidden {
            display: none;
        }

        #stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 0 10px;
        }

    </style>
</head>
<body>
    <header>
        <h1>marKit Tool</h1>
        <p>This file is released under the CC BY-NC-SA 4.0 License.<a href="https://github.com/emetlabshq/emetlabshq/blob/main/Getting_started_with_Markdown.md#markit-tool-documentation">Click Here</a> to know more.</p>
    </header>
    <div id="controls">
        <div>
            <button id="toggle-theme">Toggle Theme</button>
            <select id="theme-selector">
                <option value="default">Default</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="high-contrast">High Contrast</option>
            </select>
        </div>
        <div>
            <input type="file" id="file-upload" accept=".md" />
            <button id="generate-toc">Generate TOC</button>
            <button id="format-markdown">Format Markdown</button>
            <button id="remove-formatting">Remove Formatting</button>
        </div>
        <div>
            <input type="text" id="find-text" placeholder="Find...">
            <input type="text" id="replace-text" placeholder="Replace...">
            <button id="find-replace">Find & Replace</button>
        </div>
        <div>
            <button id="export-md">Export as .md</button>
            <button id="export-txt">Export as .txt</button>
            <button id="export-html">Export as .html</button>
            <button id="export-pdf">Export as .pdf</button>
        </div>
    </div>
    <div id="container">
        <textarea id="editor" placeholder="Type your Markdown here..."></textarea>
        <div id="preview"></div>
    </div>
    <div id="stats">
        <div><strong>Words:</strong> <span id="word-count">0</span></div>
        <div><strong>Characters:</strong> <span id="char-count">0</span></div>
        <div><strong>Lines:</strong> <span id="line-count">0</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <script>
        // DOM Elements
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const themeToggle = document.getElementById('toggle-theme');
        const themeSelector = document.getElementById('theme-selector');
        const generateToc = document.getElementById('generate-toc');
        const formatMarkdown = document.getElementById('format-markdown');
        const removeFormatting = document.getElementById('remove-formatting');
        const fileUpload = document.getElementById('file-upload');
        const exportMd = document.getElementById('export-md');
        const exportTxt = document.getElementById('export-txt');
        const exportHtml = document.getElementById('export-html');
        const exportPdf = document.getElementById('export-pdf');
        const wordCountElement = document.getElementById('word-count');
        const charCountElement = document.getElementById('char-count');
        const lineCountElement = document.getElementById('line-count');
        const findText = document.getElementById('find-text');
        const replaceText = document.getElementById('replace-text');
        const findReplaceButton = document.getElementById('find-replace');

        // Default Theme
        let currentTheme = 'default';

        // Update Preview
        function updatePreview() {
            const markdown = editor.value;
            preview.innerHTML = marked.parse(markdown);
            updateStats(markdown);
        }

        // Update Text Statistics
        function updateStats(text) {
            const words = text.split(/\s+/).filter(Boolean).length;
            const characters = text.length;
            const lines = text.split('\n').length;
            wordCountElement.textContent = words;
            charCountElement.textContent = characters;
            lineCountElement.textContent = lines;
        }

        // Toggle Theme
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
        }

        // Apply Selected Theme
        function applyTheme(theme) {
            document.body.className = '';
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else if (theme === 'light') {
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('dark-mode', 'light-mode');
            }
        }

        // Generate Table of Contents
        function generateTOC() {
            const headers = preview.querySelectorAll('h1, h2, h3, h4, h5, h6');
            if (!headers.length) {
                alert('No headings found for TOC generation.');
                return;
            }

            const toc = document.createElement('ul');
            headers.forEach(header => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${header.id}`;
                a.textContent = header.textContent;
                li.appendChild(a);
                toc.appendChild(li);
            });

            const tocContainer = document.createElement('div');
            tocContainer.innerHTML = '<h2>Table of Contents</h2>';
            tocContainer.appendChild(toc);

            preview.prepend(tocContainer);
        }

        // Format Markdown
        function formatMarkdownText() {
            const lines = editor.value.split('\n');
            const formatted = lines.map(line => line.trim()).join('\n');
            editor.value = formatted;
            updatePreview();
        }

        // Remove Markdown Formatting
        function removeMarkdownFormatting() {
            editor.value = editor.value.replace(/(\*\*|\*|~~|__|#|\>|\[.*\]\(.*\))/g, '');
            updatePreview();
        }

        // Find and Replace Text
        function findAndReplace() {
            const findValue = findText.value;
            const replaceValue = replaceText.value;
            const regex = new RegExp(findValue, 'g');
            editor.value = editor.value.replace(regex, replaceValue);
            updatePreview();
        }

        // Handle File Upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.type === 'text/markdown') {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const markdownContent = e.target.result;
                    editor.value = markdownContent;
                    updatePreview();
                };
                reader.readAsText(file);
            } else {
                alert('Please upload a valid Markdown file.');
            }
        }

        // Export Markdown to .md
        function exportMdFile() {
            const blob = new Blob([editor.value], { type: 'text/markdown' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'document.md';
            link.click();
        }

        // Export Text to .txt
        function exportTxtFile() {
            const blob = new Blob([editor.value], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'document.txt';
            link.click();
        }

        // Export HTML to .html
        function exportHtmlFile() {
            const htmlContent = `<html><body>${preview.innerHTML}</body></html>`;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'document.html';
            link.click();
        }

        // Export PDF
        function exportPdfFile() {
            const options = {
                filename: 'document.pdf',
                html2canvas: { scale: 2 },
            };
            html2pdf().from(preview).set(options).save();
        }

        // Event Listeners
        editor.addEventListener('input', updatePreview);
        themeToggle.addEventListener('click', toggleTheme);
        themeSelector.addEventListener('change', e => applyTheme(e.target.value));
        generateToc.addEventListener('click', generateTOC);
        formatMarkdown.addEventListener('click', formatMarkdownText);
        removeFormatting.addEventListener('click', removeMarkdownFormatting);
        fileUpload.addEventListener('change', handleFileUpload);
        findReplaceButton.addEventListener('click', findAndReplace);

        // Export buttons
        exportMd.addEventListener('click', exportMdFile);
        exportTxt.addEventListener('click', exportTxtFile);
        exportHtml.addEventListener('click', exportHtmlFile);
        exportPdf.addEventListener('click', exportPdfFile);

        // Initial Preview Render
        updatePreview();
    </script>
</body>
</html>
